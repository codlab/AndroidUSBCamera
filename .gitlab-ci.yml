image: 836782323787.dkr.ecr.us-east-1.amazonaws.com/android:android-ndk-r17c-sdk-28

variables:
  ANDROID_COMPILE_SDK:  "28"
  ANDROID_BUILD_TOOLS:  "28.0.2"
  ANDROID_SDK_TOOLS:    "6200805"

before_script:
  - chmod +x ./gradlew
  - echo "sdk.dir=${ANDROID_HOME}" >> local.properties
  - mkdir ~/.gradle
  - echo "VOXEET_MAVEN_PUBLISHED_GROUPID=com.voxeet.sdk" >  ~/.gradle/gradle.properties
  - echo "nexusUsername=${MAVEN_NEXUS_REPOSITORY_USER}" >> ~/.gradle/gradle.properties
  - echo "nexusPassword=${MAVEN_NEXUS_REPOSITORY_PASSWORD}" >> ~/.gradle/gradle.properties

stages:
  - install
  - deploy

build_install:
  stage: install
  script:
    - ./gradlew :installAll
    - mkdir -p repository/com/voxeet/sdk
    - cp -r ~/.m2/repository/* repository/
  artifacts:
    paths:
      - ./repository

snapshot_upload:
  stage: deploy
  script:
    - ./gradlew -PINTERNAL_RELEASE="${MAVEN_NEXUS_REPOSITORY_URL}" -PCICD_BUILD_ID="SNAPSHOT" -PCICD_SDK_SUFFIX="BETA-1" :uploadAll
